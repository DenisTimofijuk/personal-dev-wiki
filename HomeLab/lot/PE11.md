## Overview

Reference configuration for **Eastron SDM630-Modbus V2 (RS485)** connected via **Protoss PE11 RS485→Ethernet gateway** and consumed by **Home Assistant Modbus TCP**.

This document reflects a **known-working setup**.


## 1. Eastron SDM630 settings (meter)

Configured directly on the SDM630 front panel.

* **Protocol**: Modbus RTU
* **Baud rate**: `9600`
* **Data bits**: `8`
* **Stop bits**: `1`
* **Parity**: `None`
* **Slave address (Unit ID)**: `1`
* **RS485 wiring**:

  * `A / D+` → PE11 `A / D+`
  * `B / D-` → PE11 `B / D-`
  * Common **GND recommended**
* **Termination**:

  * Short cable: OFF
  * Long cable: ON at one end only

If A/B are swapped, the meter will not respond at all.


## 2. Protoss PE11 – Serial (UART) configuration

**UART / Serial settings**:

* Mode: **RS485**
* Baud rate: `9600`
* Data bits: `8`
* Stop bits: `1`
* Parity: `NONE`
* Flow control: `Disabled`

**Protocol-related settings**:

* Protocol: **Modbus**
* Frame Length: `16`
* Frame Time: `100 ms`
* Gap Time: `50 ms`
* Buffer Size: `512`

These timings are tolerant enough for SDM630 and prevent silent-frame issues.


## 3. Protoss PE11 – Network / Modbus bridge

PE11 acts as a **Modbus TCP server → Modbus RTU master**.

**Socket (NETP) configuration**:

* Protocol: `TCP-SERVER`
* Local Port: `502`
* Server Address: `0.0.0.0`
* Route: `uart`
* Max connections: `3`
* KeepAlive: `60`

**Important notes**:

* No "transparent TCP" / virtual COM modes
* No Unit ID remapping
* No register base offset
* PE11 forwards Modbus TCP Unit ID directly to RTU slave


## 4. Health check (PE11 status page)

When working correctly, you should see:

* **Serial Port State**:

  * Received Bytes: **increasing**
  * Sent Bytes: **increasing**
  * Received Frames > 0
  * Failed Frames = 0

* **Communication State (netp)**:

  * State: `Connected`
  * Frames sent/received both increasing

If `Serial Received Bytes = 0`, the problem is wiring or serial config.


## 5. Home Assistant – Modbus TCP template

Minimal working example:

```yaml
modbus:
  - name: eastron
    type: tcp
    host: 192.168.1.99
    port: 502
    timeout: 10
    delay: 10
    message_wait_milliseconds: 1000
    sensors:
      - name: "SDM630 Phase 1 Voltage"
        slave: 1
        address: 0          # 30001 → address 0
        input_type: input
        data_type: float32
        precision: 2
        unit_of_measurement: "V"
        device_class: voltage

      - name: "SDM630 Phase 2 Voltage"
        slave: 1
        address: 2          # 30003 → address 2
        input_type: input
        data_type: float32
        precision: 2
        unit_of_measurement: "V"
        device_class: voltage
```

**Notes**:

* Home Assistant uses **0-based addressing**
* SDM630 input registers start at **30001**
* `float32` is **big-endian**, works correctly with SDM630


## 6. Common failure causes (quick checklist)

* RS485 A/B swapped
* Wrong PE11 mode (transparent TCP instead of Modbus)
* Slave ID mismatch (not 1)
* Register base offset enabled in gateway
* Parity accidentally changed


## 7. Optional isolation test

If things break again:

* Connect SDM630 directly via USB–RS485
* Test with `mbpoll` / `modpoll`
* If direct RTU works → PE11 config is the issue


**End of reference**
